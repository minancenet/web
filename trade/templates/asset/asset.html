{% extends "layouts/layout_no_margin.html" %} {% block content %}

<script src='https://cdn.plot.ly/plotly-latest.min.js'></script>
<script src="{{ url_for('static', filename='js/charts.js') }}"></script>

<div class="tabs">
  <button class="tablink" onclick="openTab(event, 'sell')">Sell Candlestick Chart</button>
  <button class="tablink" onclick="openTab(event, 'buy')">Buy Candlestick Chart</button>
  <div class="outerdrop dropdown dropbtn" onclick="dropdown('timeFrameDropdown')">
    <button class="tablink dropbtn"><span class="dropbtn" id="timeFrameDisplay" style="font-family: 'Iosevka'; padding-right: 0.2rem;">1M</span><i class="fas fa-chevron-down dropbtn" style="font-size: 0.6rem;"></i></button>  
    <div id="timeFrameDropdown" class="dropdown-content alt">
      <ul>
        <li onclick="changeTimeFrame(1, 'M')">1M</li>
        <li onclick="changeTimeFrame(3, 'M')">3M</li>
        <li onclick="changeTimeFrame(5, 'M')">5M</li>
        <li onclick="changeTimeFrame(15, 'M')">15M</li>
        <li onclick="changeTimeFrame(30, 'M')">30M</li>
        <li onclick="changeTimeFrame(60, 'H')">1H</li>
        <li onclick="changeTimeFrame(120, 'H')">2H</li>
        <li onclick="changeTimeFrame(240), 'H'">4H</li>
        <li onclick="changeTimeFrame(360), 'H'">6H</li>
        <li onclick="changeTimeFrame(720), 'H'">12H</li>
        <li onclick="changeTimeFrame(1440, 'D')">1D</li>
        <li onclick="changeTimeFrame(4320, 'D')">3D</li>
        <li onclick="changeTimeFrame(10080, 'W')">1W</li>
      </ul>
    </div>
  </div>
</div>

<div class="row border-bottom">
  <div class="col-6 border-right">
    <div id="sell" class="tabcontent" style="display: block;">
      <div id="sellChart"></div>
    </div>
    <div id="buy" class="tabcontent">
      <div id="buyChart"></div>
    </div>
  </div>
  <div class="col-6">
    <div id="lineChart"></div>
  </div>
</div>
<div class="row border-bottom" style="margin-top: 0;">
  <div class="stats-section">
    <div class="row" style="display: flex;">
      <div class="col-4 border-right">
        <h5 class="section-header">Latest Orders</h5>
        <div class="row">
          <div class="col-6">
            <h5 class="section-subheader">Sell Orders</h5>
            <table class="assets-table alt">
              <tr>
                <th class="letter-td">Unit Price</th>
                <th class="number-td">Amount</th>
                <th class="number-td">Orders</th>
              </tr>
              {% for order in pickle.loads(asset.sellOrders) %}
                <tr>
                  <a href="#"><td class="letter-td">{{ order[1] }}</td></a>
                  <td class="number-td">{{ order[0] }}</td>
                  <td class="number-td">{{ order[2] }}</td>
                </tr>
              {% endfor %}
            </table>            
          </div>
          <div class="col-6">
            <h5 class="section-subheader">Buy Orders</h5>
            <table class="assets-table alt">
              <tr>
                <th class="letter-td">Unit Price</th>
                <th class="number-td">Amount</th>
                <th class="number-td">Orders</th>
              </tr>
              {% for order in pickle.loads(asset.buyOrders) %}
                <tr>
                  <a href="#"><td class="letter-td">{{ order[1] }}</td></a>
                  <td class="number-td">{{ order[0] }}</td>
                  <td class="number-td">{{ order[2] }}</td>
                </tr>
              {% endfor %}
            </table>            
          </div>
        </div>
      </div>
      <div class="col-4 border-right">
        <h5 class="section-header">Statistics</h5>
        <div class="data-table">
          <div class="entry">
            <span class="entry-label">Sell Volume:</span> <span class="entry-data">{{ asset.sellVolume }}</span>
          </div>
          <div class="entry">
            <span class="entry-label">Sell Orders:</span> <span class="entry-data">{{ asset.sellOrderAmount }}</span>
          </div>
          <div class="entry">
            <span class="entry-label">Sell Moving Week:</span> <span class="entry-data">{{ asset.sellMovingWeek }}</span>
          </div>
        </div>
        <div class="data-table">
          <div class="entry">
            <span class="entry-label">Buy Volume:</span> <span class="entry-data">{{ asset.buyVolume }}</span>
          </div>
          <div class="entry">
            <span class="entry-label">Buy Orders:</span> <span class="entry-data">{{ asset.buyOrderAmount }}</span>
          </div>
          <div class="entry">
            <span class="entry-label">Buy Moving Week:</span> <span class="entry-data">{{ asset.buyMovingWeek }}</span>
          </div>
        </div>
      </div>
      <div class="col-4">
        <h5 class="section-header">Trading</h5>
        <form method="POST" action="">
          {{ form.hidden_tag() }}
          <div class="form-group">
            <div class="form-label">
              <p>Purchase Time</p>
            </div>
            <div class="form-field">
              {% if form.purchaseDate.errors %}
              {{ form.purchaseDate(class="invalid") }}
              <div class="invalid-feedback">
                  {% for error in form.purchaseDate.errors %}
                    <span>{{ error }}</span>
                  {% endfor %}
              </div>
            {% else %}
              {{ form.purchaseDate(class="") }}
            {% endif %}
            {% if form.purchaseTime.errors %}
              {{ form.purchaseTime(class="invalid") }}
              <div class="invalid-feedback">
                  {% for error in form.purchaseTime.errors %}
                    <span>{{ error }}</span>
                  {% endfor %}
              </div>
            {% else %}
              {{ form.purchaseTime(class="") }}
            {% endif %}  
            </div>
          </div>
          <div class="clear"></div>
          <div class="form-group">
            <div class="form-label">
              <p>Sell Time</p>
            </div>
            <div class="form-field">
              {% if form.sellDate.errors %}
              {{ form.sellDate(class="invalid") }}
              <div class="invalid-feedback">
                  {% for error in form.sellDate.errors %}
                    <span>{{ error }}</span>
                  {% endfor %}
              </div>
            {% else %}
              {{ form.sellDate(class="") }}
            {% endif %}
            {% if form.sellTime.errors %}
              {{ form.sellTime(class="invalid") }}
              <div class="invalid-feedback">
                  {% for error in form.sellTime.errors %}
                    <span>{{ error }}</span>
                  {% endfor %}
              </div>
            {% else %}
              {{ form.sellTime(class="") }}
            {% endif %}  
            </div>
          </div>
          <div class="clear">
          <div class="form-group" style="margin-top: 1rem;">
            {% if session["margin"] %}
              <div class="trade-output">
                <p>{{ session["margin"] }}</p>
              </div>
            {% endif %}
          </div>
          <div class="form-group form-buttons">
            {% if form.reset.errors %}
              {{ form.reset(class="invalid") }}
              <div class="invalid-feedback">
                  {% for error in form.reset.errors %}
                    <span>{{ error }}</span>
                  {% endfor %}
              </div>
            {% else %}
              {{ form.reset(class="reset-btn") }}
            {% endif %}
            {% if form.check.errors %}
              {{ form.check(class="invalid") }}
              <div class="invalid-feedback">
                  {% for error in form.check.errors %}
                    <span>{{ error }}</span>
                  {% endfor %}
              </div>
            {% else %}
              {{ form.check(class="check-btn") }}
            {% endif %}
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  createBuySellChart("{{ asset.name }}")

  createChart("sell", 1, "{{ asset.name }}")
  createChart("buy", 1, "{{ asset.name }}")

  function changeTimeFrame(timeFrame, abbr) {
    var timeFrameDisplay = document.getElementById("timeFrameDisplay")
    timeFrameDisplay.innerHTML = timeFrame.toString() + abbr

    createChart("sell", timeFrame, "{{ asset.name }}")
    createChart("buy", timeFrame, "{{ asset.name }}")  
  }
</script>

{% endblock content %}